# üê≥ Gu√≠a Completa: Docker Compose para UI + Backend + Modelo

Esta gu√≠a te muestra dos m√©todos para desplegar tu aplicaci√≥n MLOps completa (Streamlit UI + FastAPI Backend) usando Docker Compose.

## üìã Tabla de Contenidos

1. [Arquitectura del Sistema](#arquitectura)
2. [Prerequisitos y Setup Inicial](#prerequisitos)
3. [Creaci√≥n de Archivos de Configuraci√≥n](#archivos-config)
4. [M√©todo 1: Build Local (Dockerfile)](#metodo-1)
5. [M√©todo 2: Imagen Publicada (Docker Hub)](#metodo-2)
6. [Gesti√≥n y Operaci√≥n](#gestion)
7. [Testing y Validaci√≥n](#testing)
8. [Troubleshooting](#troubleshooting)
9. [Scripts Helper Avanzados](#scripts-helper)

---

## üèóÔ∏è Arquitectura del Sistema {#arquitectura}

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ               ARQUITECTURA DOCKER COMPOSE                    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ                                                              ‚îÇ
‚îÇ  üë§ Usuario                                                   ‚îÇ
‚îÇ     ‚îÇ                                                         ‚îÇ
‚îÇ     ‚îÇ                                                         ‚îÇ
‚îÇ     ‚ñº                                                         ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ      üé® Streamlit Frontend          ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      Container: mlops-streamlit     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      Port: 8501                     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      Image: streamlit_app/          ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                 ‚îÇ                                            ‚îÇ
‚îÇ                 ‚îÇ HTTP Requests                              ‚îÇ
‚îÇ                 ‚îÇ API_URL=http://api:8000                    ‚îÇ
‚îÇ                 ‚îÇ                                            ‚îÇ
‚îÇ                 ‚ñº                                            ‚îÇ
‚îÇ  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îÇ
‚îÇ  ‚îÇ      ‚ö° FastAPI Backend              ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      Container: mlops-api           ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      Port: 8000                     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      Image: [Local Build / Hub]     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ                                     ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      üì¶ Mounted Volumes:             ‚îÇ                    ‚îÇ
‚îÇ  ‚îÇ      - ./models:/app/models         ‚îÇ                    ‚îÇ
‚îÇ  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îÇ
‚îÇ                                                              ‚îÇ
‚îÇ  ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó                     ‚îÇ
‚îÇ  ‚ïë    Docker Network: mlops-network   ‚ïë                     ‚îÇ
‚îÇ  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù                     ‚îÇ
‚îÇ                                                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

Accesos Externos:
  ‚Ä¢ Streamlit UI:    http://localhost:8501
  ‚Ä¢ FastAPI API:     http://localhost:8000
  ‚Ä¢ API Docs:        http://localhost:8000/docs
```

---

## ‚öôÔ∏è Prerequisitos y Setup Inicial {#prerequisitos}

### **Verificar Instalaci√≥n de Docker**

Antes de comenzar, aseg√∫rate de tener Docker y Docker Compose instalados:

```bash
# Verificar Docker
docker --version
# Esperado: Docker version 20.10.x o superior

# Verificar Docker Compose
docker-compose --version
# Esperado: Docker Compose version v2.x.x o superior

# Verificar que Docker est√° corriendo
docker ps
# Si aparece error, inicia Docker Desktop
```

### **Estructura de Proyecto Requerida**

Tu proyecto debe tener la siguiente estructura antes de comenzar:

```bash
mlops-lab/
‚îú‚îÄ‚îÄ üìÑ Dockerfile                    # Imagen de FastAPI
‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ api/
‚îÇ       ‚îú‚îÄ‚îÄ main.py                  # FastAPI app
‚îÇ       ‚îú‚îÄ‚îÄ inference.py             # L√≥gica de predicci√≥n
‚îÇ       ‚îú‚îÄ‚îÄ schemas.py               # Modelos Pydantic
‚îÇ       ‚îî‚îÄ‚îÄ requirements.txt         # Dependencias API
‚îú‚îÄ‚îÄ üìÅ models/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ trained/
‚îÇ       ‚îú‚îÄ‚îÄ house_price_model.pkl    # Modelo entrenado
‚îÇ       ‚îî‚îÄ‚îÄ preprocessor.pkl         # Preprocessor
‚îú‚îÄ‚îÄ üìÅ streamlit_app/
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Dockerfile                # Imagen de Streamlit
‚îÇ   ‚îú‚îÄ‚îÄ app.py                       # Aplicaci√≥n web
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt             # Dependencias Streamlit
‚îî‚îÄ‚îÄ üìÅ configs/
    ‚îî‚îÄ‚îÄ model_config.yaml            # Configuraci√≥n del modelo
```

### **Verificar Archivos Esenciales**

```bash
# Verificar que los Dockerfiles existen
ls -la Dockerfile
ls -la streamlit_app/Dockerfile

# Verificar que los modelos est√°n entrenados
ls -la models/trained/house_price_model.pkl
ls -la models/trained/preprocessor.pkl

# Verificar API
ls -la src/api/main.py
ls -la src/api/inference.py

# Si falta alg√∫n archivo, entr√©nalos primero:
# python src/models/train_model.py --config configs/model_config.yaml
```

---

## üìù Creaci√≥n de Archivos de Configuraci√≥n {#archivos-config}

Antes de usar Docker Compose, necesitas crear varios archivos de configuraci√≥n y scripts helper.

### **Archivo 1: docker-compose.yaml**

Este es el archivo principal de orquestaci√≥n. Cr√©alo en la ra√≠z del proyecto:

**`docker-compose.yaml`**

```yaml
version: '3.8'

services:
  # FastAPI Backend Service
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mlops-api
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      # Mount models directory for live updates during development
      - ./models:/app/models
    networks:
      - mlops-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # Streamlit Frontend Service
  streamlit:
    build:
      context: ./streamlit_app
      dockerfile: Dockerfile
    container_name: mlops-streamlit
    ports:
      - "8501:8501"
    environment:
      - PYTHONUNBUFFERED=1
      - API_URL=http://api:8000
    depends_on:
      api:
        condition: service_healthy
    networks:
      - mlops-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped

networks:
  mlops-network:
    driver: bridge
```

**üîë Caracter√≠sticas Clave:**

- **Servicios separados**: API y Streamlit en contenedores independientes
- **Red privada**: `mlops-network` para comunicaci√≥n segura entre contenedores
- **Health checks**: Monitoreo autom√°tico del estado de los servicios
- **Auto-restart**: Los servicios se reinician autom√°ticamente si fallan
- **Vol√∫menes**: Los modelos se montan para actualizaciones sin rebuild
- **Variables de entorno**: `API_URL=http://api:8000` para conectividad

---

### **Archivo 2: .env.example**

Template para variables de entorno:

**`.env.example`**

```bash
# MLOps Lab - Environment Variables Example
# Copy this file to .env and adjust values as needed

# API Configuration
API_PORT=8000
API_HOST=0.0.0.0

# Streamlit Configuration
STREAMLIT_PORT=8501
API_URL=http://api:8000

# Python Configuration
PYTHONUNBUFFERED=1

# Model Configuration
MODEL_PATH=/app/models/trained/best_model.pkl

# Docker Hub Configuration (para M√©todo 2)
DOCKERHUB_USERNAME=tu-usuario
IMAGE_TAG=latest

# MLflow Configuration (opcional)
# MLFLOW_TRACKING_URI=http://mlflow:5000
```

---

### **Archivo 3: docker-manager.sh**

Script helper para gesti√≥n simplificada de Docker Compose:

**`docker-manager.sh`**

```bash
#!/bin/bash

# MLOps Lab - Docker Compose Helper Script
# Este script facilita la gesti√≥n de los servicios Docker

set -e

# Colors para output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Banner
echo -e "${BLUE}"
echo "‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó"
echo "‚ïë     MLOps Lab - Docker Manager         ‚ïë"
echo "‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù"
echo -e "${NC}"

# Function to display help
show_help() {
    echo "Usage: ./docker-manager.sh [COMMAND]"
    echo ""
    echo "Commands:"
    echo -e "  ${GREEN}start${NC}      Build and start all services"
    echo -e "  ${GREEN}stop${NC}       Stop all services"
    echo -e "  ${GREEN}restart${NC}    Restart all services"
    echo -e "  ${GREEN}logs${NC}       Show logs from all services"
    echo -e "  ${GREEN}logs-api${NC}   Show logs from API service only"
    echo -e "  ${GREEN}logs-ui${NC}    Show logs from Streamlit service only"
    echo -e "  ${GREEN}status${NC}     Show status of all services"
    echo -e "  ${GREEN}clean${NC}      Stop and remove all containers, networks, and volumes"
    echo -e "  ${GREEN}rebuild${NC}    Clean and rebuild everything from scratch"
    echo -e "  ${GREEN}shell-api${NC}  Open bash shell in API container"
    echo -e "  ${GREEN}shell-ui${NC}   Open bash shell in Streamlit container"
    echo -e "  ${GREEN}test${NC}       Test API connectivity"
    echo -e "  ${GREEN}help${NC}       Show this help message"
    echo ""
}

# Function to start services
start_services() {
    echo -e "${YELLOW}üöÄ Building and starting services...${NC}"
    docker-compose up --build -d
    echo ""
    echo -e "${GREEN}‚úÖ Services started successfully!${NC}"
    echo ""
    show_urls
}

# Function to stop services
stop_services() {
    echo -e "${YELLOW}üõë Stopping services...${NC}"
    docker-compose down
    echo -e "${GREEN}‚úÖ Services stopped${NC}"
}

# Function to restart services
restart_services() {
    echo -e "${YELLOW}üîÑ Restarting services...${NC}"
    docker-compose restart
    echo -e "${GREEN}‚úÖ Services restarted${NC}"
    show_urls
}

# Function to show logs
show_logs() {
    echo -e "${YELLOW}üìã Showing logs (Ctrl+C to exit)...${NC}"
    docker-compose logs -f
}

# Function to show API logs
show_api_logs() {
    echo -e "${YELLOW}üìã Showing API logs (Ctrl+C to exit)...${NC}"
    docker-compose logs -f api
}

# Function to show Streamlit logs
show_streamlit_logs() {
    echo -e "${YELLOW}üìã Showing Streamlit logs (Ctrl+C to exit)...${NC}"
    docker-compose logs -f streamlit
}

# Function to show status
show_status() {
    echo -e "${YELLOW}üìä Service Status:${NC}"
    docker-compose ps
}

# Function to clean everything
clean_all() {
    echo -e "${RED}üßπ Cleaning all containers, networks, and volumes...${NC}"
    docker-compose down -v
    echo -e "${GREEN}‚úÖ Cleanup complete${NC}"
}

# Function to rebuild from scratch
rebuild_all() {
    echo -e "${RED}üî® Rebuilding everything from scratch...${NC}"
    docker-compose down -v
    docker-compose build --no-cache
    docker-compose up -d
    echo ""
    echo -e "${GREEN}‚úÖ Rebuild complete!${NC}"
    echo ""
    show_urls
}

# Function to open shell in API container
shell_api() {
    echo -e "${YELLOW}üêö Opening shell in API container...${NC}"
    docker-compose exec api bash
}

# Function to open shell in Streamlit container
shell_streamlit() {
    echo -e "${YELLOW}üêö Opening shell in Streamlit container...${NC}"
    docker-compose exec streamlit bash
}

# Function to test API
test_api() {
    echo -e "${YELLOW}üß™ Testing API connectivity...${NC}"
    echo ""
    
    # Test health endpoint
    echo -e "${BLUE}Testing health endpoint...${NC}"
    if curl -s http://localhost:8000/health > /dev/null; then
        echo -e "${GREEN}‚úÖ API is healthy${NC}"
    else
        echo -e "${RED}‚ùå API is not responding${NC}"
        return 1
    fi
    
    # Test prediction endpoint
    echo ""
    echo -e "${BLUE}Testing prediction endpoint...${NC}"
    response=$(curl -s -X POST http://localhost:8000/predict \
        -H "Content-Type: application/json" \
        -d '{
            "sqft": 2000,
            "bedrooms": 3,
            "bathrooms": 2,
            "location": "Suburb",
            "year_built": 2010,
            "condition": "Good",
            "price_per_sqft": 250
        }')
    
    if echo "$response" | grep -q "predicted_price"; then
        echo -e "${GREEN}‚úÖ Prediction endpoint working${NC}"
        echo ""
        echo "Sample prediction response:"
        echo "$response" | python3 -m json.tool 2>/dev/null || echo "$response"
    else
        echo -e "${RED}‚ùå Prediction endpoint failed${NC}"
        return 1
    fi
}

# Function to show URLs
show_urls() {
    echo -e "${BLUE}üìç Access your services at:${NC}"
    echo -e "  ${GREEN}API (FastAPI):${NC}     http://localhost:8000"
    echo -e "  ${GREEN}API Docs:${NC}          http://localhost:8000/docs"
    echo -e "  ${GREEN}Streamlit UI:${NC}      http://localhost:8501"
    echo ""
}

# Main script logic
case "${1:-help}" in
    start)
        start_services
        ;;
    stop)
        stop_services
        ;;
    restart)
        restart_services
        ;;
    logs)
        show_logs
        ;;
    logs-api)
        show_api_logs
        ;;
    logs-ui)
        show_streamlit_logs
        ;;
    status)
        show_status
        ;;
    clean)
        clean_all
        ;;
    rebuild)
        rebuild_all
        ;;
    shell-api)
        shell_api
        ;;
    shell-ui)
        shell_streamlit
        ;;
    test)
        test_api
        ;;
    help|--help|-h)
        show_help
        ;;
    *)
        echo -e "${RED}‚ùå Unknown command: $1${NC}"
        echo ""
        show_help
        exit 1
        ;;
esac
```

Dar permisos de ejecuci√≥n:

```bash
chmod +x docker-manager.sh
```

---

### **Archivo 4: test-deployment.sh**

Suite de pruebas automatizada para validar el deployment:

**`test-deployment.sh`**

```bash
#!/bin/bash

# Quick Test Script for MLOps Lab Docker Setup
# Este script verifica que los servicios est√©n funcionando correctamente

set -e

# Colors
GREEN='\033[0;32m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m'

echo -e "${BLUE}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${BLUE}‚ïë  MLOps Lab - Quick Test Suite            ‚ïë${NC}"
echo -e "${BLUE}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""

# Check if services are running
echo -e "${YELLOW}üìä Checking if services are running...${NC}"
if ! docker-compose ps | grep -q "Up"; then
    echo -e "${RED}‚ùå Services are not running. Please run './docker-manager.sh start' first${NC}"
    exit 1
fi
echo -e "${GREEN}‚úÖ Services are running${NC}"
echo ""

# Test API Health
echo -e "${YELLOW}üè• Testing API health endpoint...${NC}"
if response=$(curl -s -f http://localhost:8000/health); then
    echo -e "${GREEN}‚úÖ API health check passed${NC}"
    echo "   Response: $response"
else
    echo -e "${RED}‚ùå API health check failed${NC}"
    exit 1
fi
echo ""

# Test API Docs
echo -e "${YELLOW}üìö Testing API documentation endpoint...${NC}"
if curl -s -f http://localhost:8000/docs > /dev/null; then
    echo -e "${GREEN}‚úÖ API docs are accessible at http://localhost:8000/docs${NC}"
else
    echo -e "${RED}‚ùå API docs are not accessible${NC}"
    exit 1
fi
echo ""

# Test Prediction Endpoint
echo -e "${YELLOW}üîÆ Testing prediction endpoint...${NC}"
prediction=$(curl -s -X POST http://localhost:8000/predict \
    -H "Content-Type: application/json" \
    -d '{
        "sqft": 2000,
        "bedrooms": 3,
        "bathrooms": 2,
        "location": "Suburb",
        "year_built": 2010,
        "condition": "Good",
        "price_per_sqft": 250
    }')

if echo "$prediction" | grep -q "predicted_price"; then
    echo -e "${GREEN}‚úÖ Prediction endpoint working${NC}"
    
    # Extract and display predicted price
    if command -v python3 &> /dev/null; then
        price=$(echo "$prediction" | python3 -c "import sys, json; data=json.load(sys.stdin); print(f\"\${data['predicted_price']:,.2f}\")" 2>/dev/null || echo "N/A")
        echo "   Predicted Price: $price"
    fi
    
    echo "   Full response:"
    echo "$prediction" | python3 -m json.tool 2>/dev/null || echo "$prediction"
else
    echo -e "${RED}‚ùå Prediction endpoint failed${NC}"
    echo "   Response: $prediction"
    exit 1
fi
echo ""

# Test Streamlit
echo -e "${YELLOW}üé® Testing Streamlit frontend...${NC}"
if curl -s -f http://localhost:8501/_stcore/health > /dev/null; then
    echo -e "${GREEN}‚úÖ Streamlit is accessible at http://localhost:8501${NC}"
else
    echo -e "${RED}‚ùå Streamlit is not accessible${NC}"
    exit 1
fi
echo ""

# Test Network Connectivity (Streamlit -> API)
echo -e "${YELLOW}üåê Testing network connectivity between services...${NC}"
if docker-compose exec -T streamlit curl -s -f http://api:8000/health > /dev/null 2>&1; then
    echo -e "${GREEN}‚úÖ Streamlit can reach API backend${NC}"
else
    echo -e "${RED}‚ùå Network connectivity issue between services${NC}"
    exit 1
fi
echo ""

# Summary
echo -e "${GREEN}‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó${NC}"
echo -e "${GREEN}‚ïë  ‚úÖ All Tests Passed Successfully!       ‚ïë${NC}"
echo -e "${GREEN}‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù${NC}"
echo ""
echo -e "${BLUE}Access your applications:${NC}"
echo -e "  ‚Ä¢ API Backend:     ${GREEN}http://localhost:8000${NC}"
echo -e "  ‚Ä¢ API Docs:        ${GREEN}http://localhost:8000/docs${NC}"
echo -e "  ‚Ä¢ Streamlit UI:    ${GREEN}http://localhost:8501${NC}"
echo ""
```

Dar permisos de ejecuci√≥n:

```bash
chmod +x test-deployment.sh
```

---

### **Archivo 6: api-test-examples.sh**

Ejemplos predefinidos para testear la API:

**`api-test-examples.sh`**

```bash
#!/bin/bash

# API Test Examples
# Ejemplos de c√≥mo usar la API de predicci√≥n de precios

echo "üè† House Price Prediction API - Test Examples"
echo "=============================================="
echo ""

# Base URL
API_URL="${API_URL:-http://localhost:8000}"

echo "üìç API URL: $API_URL"
echo ""

# Test 1: Health Check
echo "1Ô∏è‚É£  Health Check"
echo "   Command: curl $API_URL/health"
echo ""
curl -s $API_URL/health | python3 -m json.tool 2>/dev/null || curl -s $API_URL/health
echo ""
echo ""

# Test 2: Basic Prediction - Suburban House
echo "2Ô∏è‚É£  Prediction: Suburban Family Home"
echo "   (2000 sqft, 3 bed, 2 bath, built 2010)"
echo ""
curl -s -X POST "$API_URL/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 2000,
    "bedrooms": 3,
    "bathrooms": 2,
    "location": "Suburb",
    "year_built": 2010,
    "condition": "Good",
    "price_per_sqft": 250
  }' | python3 -m json.tool 2>/dev/null
echo ""
echo ""

# Test 3: Luxury Downtown Condo
echo "3Ô∏è‚É£  Prediction: Luxury Downtown Condo"
echo "   (1500 sqft, 2 bed, 2.5 bath, built 2020)"
echo ""
curl -s -X POST "$API_URL/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 1500,
    "bedrooms": 2,
    "bathrooms": 2.5,
    "location": "Downtown",
    "year_built": 2020,
    "condition": "Excellent",
    "price_per_sqft": 450
  }' | python3 -m json.tool 2>/dev/null
echo ""
echo ""

# Test 4: Rural Property
echo "4Ô∏è‚É£  Prediction: Rural Property"
echo "   (2500 sqft, 4 bed, 3 bath, built 1995)"
echo ""
curl -s -X POST "$API_URL/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 2500,
    "bedrooms": 4,
    "bathrooms": 3,
    "location": "Rural",
    "year_built": 1995,
    "condition": "Fair",
    "price_per_sqft": 180
  }' | python3 -m json.tool 2>/dev/null
echo ""
echo ""

# Test 5: Waterfront Estate
echo "5Ô∏è‚É£  Prediction: Waterfront Estate"
echo "   (4000 sqft, 5 bed, 4 bath, built 2015)"
echo ""
curl -s -X POST "$API_URL/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 4000,
    "bedrooms": 5,
    "bathrooms": 4,
    "location": "Waterfront",
    "year_built": 2015,
    "condition": "Excellent",
    "price_per_sqft": 500
  }' | python3 -m json.tool 2>/dev/null
echo ""
echo ""

# Test 6: Small Urban Apartment
echo "6Ô∏è‚É£  Prediction: Small Urban Apartment"
echo "   (800 sqft, 1 bed, 1 bath, built 2018)"
echo ""
curl -s -X POST "$API_URL/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 800,
    "bedrooms": 1,
    "bathrooms": 1,
    "location": "Urban",
    "year_built": 2018,
    "condition": "Good",
    "price_per_sqft": 300
  }' | python3 -m json.tool 2>/dev/null
echo ""
echo ""

echo "‚úÖ All test examples completed!"
echo ""
echo "üí° Tips:"
echo "   - Modify the JSON data to test different scenarios"
echo "   - Check the API docs at $API_URL/docs for more details"
echo "   - Use the Streamlit UI at http://localhost:8501 for interactive testing"
```

Dar permisos de ejecuci√≥n:

```bash
chmod +x api-test-examples.sh
```

---

### **Archivo 6: QUICKSTART.md**

Gu√≠a de inicio r√°pido en 3 pasos:

**`QUICKSTART.md`**

```markdown
# üöÄ Quick Start - MLOps Lab Docker

## Inicio en 3 Pasos

### 1Ô∏è‚É£ Aseg√∫rate de tener Docker instalado

\`\`\`bash
docker --version
docker-compose --version
\`\`\`

### 2Ô∏è‚É£ Inicia los servicios

\`\`\`bash
# Opci√≥n A: Usando el script manager (recomendado)
./docker-manager.sh start

# Opci√≥n B: Usando docker-compose directamente
docker-compose up --build -d
\`\`\`

### 3Ô∏è‚É£ Accede a las aplicaciones

- **Streamlit UI**: http://localhost:8501 ‚Üê Empieza aqu√≠ üéØ
- **API Backend**: http://localhost:8000
- **API Docs**: http://localhost:8000/docs

---

## üß™ Verificar que Todo Funciona

\`\`\`bash
# Ejecutar suite de pruebas
./test-deployment.sh

# O manualmente:
curl http://localhost:8000/health
\`\`\`

---

## üõë Detener Todo

\`\`\`bash
# Opci√≥n A: Con el script
./docker-manager.sh stop

# Opci√≥n B: Con docker-compose
docker-compose down
\`\`\`

---

## üìã Comandos √ötiles

\`\`\`bash
# Ver logs en tiempo real
./docker-manager.sh logs

# Ver solo logs de la API
./docker-manager.sh logs-api

# Ver solo logs del frontend
./docker-manager.sh logs-ui

# Ver estado de los servicios
./docker-manager.sh status

# Probar la API
./docker-manager.sh test

# Reconstruir todo desde cero
./docker-manager.sh rebuild
\`\`\`

---

## üìö M√°s Informaci√≥n

- **Gu√≠a Completa**: Ver `docs/6. mlops-ui-backend-model.md`
- **Troubleshooting**: Consultar secci√≥n de resoluci√≥n de problemas en la gu√≠a

---

## üí° Ejemplo de Uso de la API

\`\`\`bash
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 2000,
    "bedrooms": 3,
    "bathrooms": 2,
    "location": "Suburb",
    "year_built": 2010,
    "condition": "Good",
    "price_per_sqft": 250
  }'
\`\`\`

Respuesta esperada:
\`\`\`json
{
  "predicted_price": 525000.0,
  "confidence_interval": [480000.0, 570000.0],
  "model_version": "1.0",
  "features_used": {...}
}
\`\`\`
```

---

### **‚úÖ Checklist de Archivos Creados**

Verifica que has creado todos estos archivos:

```bash
# Archivos principales
ls -la docker-compose.yaml          # ‚úÖ Orquestaci√≥n
ls -la .env.example                 # ‚úÖ Template variables

# Scripts ejecutables
ls -la docker-manager.sh            # ‚úÖ Gesti√≥n Docker
ls -la test-deployment.sh           # ‚úÖ Suite de pruebas
ls -la api-test-examples.sh         # ‚úÖ Ejemplos API

# Documentaci√≥n
ls -la QUICKSTART.md                # ‚úÖ Gu√≠a r√°pida

# Dar permisos de ejecuci√≥n a scripts
chmod +x docker-manager.sh
chmod +x test-deployment.sh
chmod +x api-test-examples.sh
```

**üéØ Estructura Final del Proyecto:**

```
mlops-lab/
‚îú‚îÄ‚îÄ üìÑ docker-compose.yaml           ‚Üê NUEVO
‚îú‚îÄ‚îÄ üìÑ .dockerignore                 ‚Üê NUEVO
‚îú‚îÄ‚îÄ üìÑ .env.example                  ‚Üê NUEVO
‚îú‚îÄ‚îÄ üöÄ docker-manager.sh             ‚Üê NUEVO (ejecutable)
‚îú‚îÄ‚îÄ üß™ test-deployment.sh            ‚Üê NUEVO (ejecutable)
‚îú‚îÄ‚îÄ üß™ api-test-examples.sh          ‚Üê NUEVO (ejecutable)
‚îú‚îÄ‚îÄ üìñ QUICKSTART.md                 ‚Üê NUEVO
‚îú‚îÄ‚îÄ üìÑ Dockerfile                    ‚Üê YA EXISTE
‚îú‚îÄ‚îÄ üìÅ src/api/                      ‚Üê YA EXISTE
‚îú‚îÄ‚îÄ üìÅ models/trained/               ‚Üê YA EXISTE
‚îú‚îÄ‚îÄ üìÅ streamlit_app/                ‚Üê YA EXISTE
‚îî‚îÄ‚îÄ üìÅ docs/
    ‚îî‚îÄ‚îÄ 6. mlops-ui-backend-model.md ‚Üê ESTA GU√çA
```

---

## üîß M√©todo 1: Build Local con Dockerfile {#metodo-1}

Este m√©todo construye las im√°genes Docker localmente usando los Dockerfiles del proyecto.

### **‚úÖ Ventajas**
- üöÄ Control total sobre el build
- üîß Ideal para desarrollo activo
- ‚ö° Cambios r√°pidos en c√≥digo
- üîê No requiere Docker Hub

### **‚ùå Desventajas**
- ‚è±Ô∏è Build inicial m√°s lento
- üíæ Requiere m√°s espacio en disco
- üîÑ Rebuilds frecuentes en desarrollo

---

### **Paso 1: Estructura del Proyecto**

Verifica que tu proyecto tenga esta estructura:

```bash
mlops-lab/
‚îú‚îÄ‚îÄ üìÑ docker-compose.yaml       # Configuraci√≥n de servicios
‚îú‚îÄ‚îÄ üìÑ Dockerfile                # Imagen de FastAPI
‚îú‚îÄ‚îÄ üìÅ src/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ api/
‚îÇ       ‚îú‚îÄ‚îÄ main.py
‚îÇ       ‚îú‚îÄ‚îÄ inference.py
‚îÇ       ‚îú‚îÄ‚îÄ schemas.py
‚îÇ       ‚îî‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ üìÅ models/
‚îÇ   ‚îî‚îÄ‚îÄ üìÅ trained/
‚îÇ       ‚îú‚îÄ‚îÄ house_price_model.pkl
‚îÇ       ‚îî‚îÄ‚îÄ preprocessor.pkl
‚îî‚îÄ‚îÄ üìÅ streamlit_app/
    ‚îú‚îÄ‚îÄ üìÑ Dockerfile
    ‚îú‚îÄ‚îÄ app.py
    ‚îî‚îÄ‚îÄ requirements.txt
```

---

### **Paso 2: Archivo docker-compose.yaml (Build Local)**

Crea o verifica el archivo `docker-compose.yaml` en la ra√≠z del proyecto:

```yaml
version: '3.8'

services:
  # FastAPI Backend Service
  api:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mlops-api
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      # Mount models directory for live updates during development
      - ./models:/app/models
    networks:
      - mlops-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # Streamlit Frontend Service
  streamlit:
    build:
      context: ./streamlit_app
      dockerfile: Dockerfile
    container_name: mlops-streamlit
    ports:
      - "8501:8501"
    environment:
      - PYTHONUNBUFFERED=1
      - API_URL=http://api:8000
    depends_on:
      api:
        condition: service_healthy
    networks:
      - mlops-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped

networks:
  mlops-network:
    driver: bridge
```

**üîë Puntos Clave:**

- `build.context: .` - Construye desde el Dockerfile local
- `volumes: ./models:/app/models` - Monta modelos para actualizaciones en caliente
- `depends_on.condition: service_healthy` - Streamlit espera a que API est√© lista
- `networks: mlops-network` - Red privada para comunicaci√≥n entre contenedores

---

### **Paso 3: Construir y Levantar Servicios**

#### **Opci√≥n A: Usando Script Manager (Recomendado)**

```bash
# Dar permisos de ejecuci√≥n (solo la primera vez)
chmod +x docker-manager.sh

# Iniciar todos los servicios
./docker-manager.sh start
```

**Output esperado:**
```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë     MLOps Lab - Docker Manager         ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üöÄ Building and starting services...
[+] Building 45.2s (20/20) FINISHED
[+] Running 3/3
 ‚úî Network mlops-network       Created
 ‚úî Container mlops-api          Started
 ‚úî Container mlops-streamlit    Started

‚úÖ Services started successfully!

üìç Access your services at:
  API (FastAPI):     http://localhost:8000
  API Docs:          http://localhost:8000/docs
  Streamlit UI:      http://localhost:8501
```

#### **Opci√≥n B: Comandos Docker Compose Directos**

```bash
# Construir y levantar en modo detached
docker-compose up --build -d

# Ver logs en tiempo real
docker-compose logs -f

# Ver estado de los servicios
docker-compose ps
```

---

### **Paso 4: Verificaci√≥n Post-Deploy**

#### **1. Health Checks**

```bash
# Verificar API
curl http://localhost:8000/health

# Esperado:
# {"status": "healthy", "model_loaded": true}
```

#### **2. Test de Predicci√≥n**

```bash
curl -X POST "http://localhost:8000/predict" \
  -H "Content-Type: application/json" \
  -d '{
    "sqft": 2000,
    "bedrooms": 3,
    "bathrooms": 2,
    "location": "Suburb",
    "year_built": 2010,
    "condition": "Good",
    "price_per_sqft": 250
  }'

# Esperado:
# {
#   "predicted_price": 525000.0,
#   "confidence_interval": [480000.0, 570000.0],
#   ...
# }
```

#### **3. Verificar Streamlit UI**

```bash
# Abrir en navegador
open http://localhost:8501

# O verificar health
curl http://localhost:8501/_stcore/health
```

#### **4. Suite de Pruebas Completa**

```bash
# Ejecutar todas las pruebas automatizadas
./test-deployment.sh
```

---

### **Paso 5: Operaci√≥n y Monitoreo**

#### **Ver Logs**

```bash
# Logs de todos los servicios
docker-compose logs -f

# Solo API
docker-compose logs -f api

# Solo Streamlit
docker-compose logs -f streamlit

# √öltimas 100 l√≠neas
docker-compose logs --tail=100
```

#### **Reiniciar Servicios**

```bash
# Reiniciar todos
docker-compose restart

# Reiniciar solo API (√∫til despu√©s de cambios en modelos)
docker-compose restart api

# Reiniciar solo frontend
docker-compose restart streamlit
```

#### **Detener Servicios**

```bash
# Detener sin eliminar contenedores
docker-compose stop

# Detener y eliminar contenedores
docker-compose down

# Detener y eliminar todo (incluidos vol√∫menes)
docker-compose down -v
```

---

### **Paso 6: Desarrollo con Hot Reload**

#### **Actualizar Modelos sin Rebuild**

Gracias al volumen montado (`./models:/app/models`), puedes actualizar modelos sin reconstruir:

```bash
# 1. Entrenar nuevo modelo
python src/models/train_model.py --config configs/model_config.yaml

# 2. Reiniciar solo el servicio API
docker-compose restart api

# 3. Verificar nuevo modelo
curl http://localhost:8000/health
```

#### **Cambios en C√≥digo**

Para cambios en c√≥digo Python:

```bash
# Opci√≥n 1: Rebuild espec√≠fico
docker-compose up -d --build api

# Opci√≥n 2: Rebuild completo
./docker-manager.sh rebuild

# Opci√≥n 3: Rebuild sin cache
docker-compose build --no-cache
docker-compose up -d
```

---

## üì¶ M√©todo 2: Imagen Publicada de Docker Hub {#metodo-2}

Este m√©todo descarga la imagen pre-construida de Docker Hub (publicada por el CI/CD pipeline).

### **‚úÖ Ventajas**
- ‚ö° Deploy extremadamente r√°pido
- üéØ Imagen ya testeada en CI/CD
- üíæ Menos espacio en disco local
- üöÄ Ideal para producci√≥n

### **‚ùå Desventajas**
- üîê Requiere acceso a Docker Hub
- üîÑ No permite cambios r√°pidos en c√≥digo
- üì° Requiere conexi√≥n a internet

---

### **Paso 1: Verificar Imagen en Docker Hub**

Antes de comenzar, verifica que tu imagen est√© publicada:

1. Visita: `https://hub.docker.com/r/TU-USERNAME/house-price-model`
2. Busca los tags disponibles:
   - `latest` - Versi√≥n m√°s reciente
   - `COMMIT-HASH` - Versiones espec√≠ficas

**Ejemplo:**
```
https://hub.docker.com/r/pytuxi/house-price-model
```

---

### **Paso 2: docker-compose.yaml (Imagen de Docker Hub)**

Crea un archivo `docker-compose.prod.yaml` o modifica el existente:

```yaml
version: '3.8'

services:
  # FastAPI Backend Service (Usando imagen de Docker Hub)
  api:
    image: TU-USERNAME/house-price-model:latest
    container_name: mlops-api
    ports:
      - "8000:8000"
    environment:
      - PYTHONUNBUFFERED=1
    volumes:
      # Optional: Mount local models to override image models
      - ./models:/app/models
    networks:
      - mlops-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped

  # Streamlit Frontend Service
  streamlit:
    build:
      context: ./streamlit_app
      dockerfile: Dockerfile
    container_name: mlops-streamlit
    ports:
      - "8501:8501"
    environment:
      - PYTHONUNBUFFERED=1
      - API_URL=http://api:8000
    depends_on:
      api:
        condition: service_healthy
    networks:
      - mlops-network
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8501/_stcore/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 15s
    restart: unless-stopped

networks:
  mlops-network:
    driver: bridge
```

**üîë Diferencias Clave:**

```yaml
# ‚ùå ANTES (Build Local)
api:
  build:
    context: .
    dockerfile: Dockerfile

# ‚úÖ AHORA (Docker Hub)
api:
  image: TU-USERNAME/house-price-model:latest
```

---

### **Paso 3: Configurar Variables de Usuario**

Reemplaza `TU-USERNAME` con tu usuario real de Docker Hub:

#### **M√©todo A: Editar docker-compose.yaml**

```yaml
api:
  image: pytuxi/house-price-model:latest  # ‚Üê Cambiar aqu√≠
```

#### **M√©todo B: Usar Variables de Entorno**

Crea archivo `.env`:

```bash
# .env
DOCKERHUB_USERNAME=pytuxi
IMAGE_TAG=latest
```

Actualiza `docker-compose.yaml`:

```yaml
api:
  image: ${DOCKERHUB_USERNAME}/house-price-model:${IMAGE_TAG}
```

---

### **Paso 4: Descargar y Levantar Servicios**

#### **1. Pull Manual (Opcional)**

```bash
# Descargar imagen antes de levantar
docker pull TU-USERNAME/house-price-model:latest

# Verificar descarga
docker images | grep house-price-model
```

**Output esperado:**
```
TU-USERNAME/house-price-model   latest    abc123def456   2 days ago    500MB
```

#### **2. Levantar con Docker Compose**

```bash
# Docker Compose descarga autom√°ticamente si no existe localmente
docker-compose -f docker-compose.prod.yaml up -d

# O si modificaste el docker-compose.yaml original
docker-compose up -d
```

**Output esperado:**
```
[+] Running 3/3
 ‚úî Network mlops-network       Created
 ‚úî Container mlops-api          Started
 ‚úî Container mlops-streamlit    Started
```

#### **3. Verificar Pull y Startup**

```bash
# Ver logs de inicio
docker-compose logs -f

# Esperado en logs de API:
# ‚úÖ Model loaded: RandomForestRegressor
# ‚úÖ Preprocessor loaded successfully
# INFO: Uvicorn running on http://0.0.0.0:8000
```

---

### **Paso 5: Testing Post-Deploy**

#### **1. Health Checks**

```bash
# API Health
curl http://localhost:8000/health

# Streamlit Health
curl http://localhost:8501/_stcore/health
```

#### **2. Test de Predicci√≥n Completo**

```bash
# Ejecutar suite de pruebas
./test-deployment.sh
```

**Output esperado:**
```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  MLOps Lab - Quick Test Suite            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìä Checking if services are running...
‚úÖ Services are running

üè• Testing API health endpoint...
‚úÖ API health check passed

üîÆ Testing prediction endpoint...
‚úÖ Prediction endpoint working
   Predicted Price: $525,000.00

üé® Testing Streamlit frontend...
‚úÖ Streamlit is accessible at http://localhost:8501

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ‚úÖ All Tests Passed Successfully!       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

#### **3. Test Manual en Streamlit**

```bash
# Abrir UI en navegador
open http://localhost:8501
```

**Pasos en la UI:**
1. Ajustar par√°metros de la casa
2. Click en "Predict Price"
3. Verificar que obtienes predicci√≥n exitosa
4. Confirmar que no hay errores de conexi√≥n con API

---

### **Paso 6: Actualizar a Nueva Versi√≥n**

#### **Opci√≥n A: Actualizar a Latest**

```bash
# 1. Detener servicios
docker-compose down

# 2. Pull nueva versi√≥n
docker pull TU-USERNAME/house-price-model:latest

# 3. Reiniciar
docker-compose up -d

# 4. Verificar versi√≥n
docker images TU-USERNAME/house-price-model:latest
```

#### **Opci√≥n B: Usar Versi√≥n Espec√≠fica**

```bash
# 1. Editar docker-compose.yaml
# Cambiar: image: TU-USERNAME/house-price-model:latest
# Por:     image: TU-USERNAME/house-price-model:a1b2c3d

# 2. Pull versi√≥n espec√≠fica
docker pull TU-USERNAME/house-price-model:a1b2c3d

# 3. Levantar con nueva versi√≥n
docker-compose up -d

# 4. Verificar
curl http://localhost:8000/health
```

#### **Opci√≥n C: Rollback a Versi√≥n Anterior**

```bash
# 1. Identificar versi√≥n anterior
docker images TU-USERNAME/house-price-model

# 2. Cambiar tag en docker-compose.yaml
# image: TU-USERNAME/house-price-model:VERSION-ANTERIOR

# 3. Restart
docker-compose up -d --force-recreate

# 4. Verificar
./test-deployment.sh
```

---

### **Paso 7: Configuraci√≥n de Producci√≥n**

#### **Variables de Entorno**

Crea archivo `.env` para producci√≥n:

```bash
# .env
DOCKERHUB_USERNAME=pytuxi
IMAGE_TAG=latest
API_PORT=8000
STREAMLIT_PORT=8501
```

Actualiza `docker-compose.yaml`:

```yaml
services:
  api:
    image: ${DOCKERHUB_USERNAME}/house-price-model:${IMAGE_TAG}
    ports:
      - "${API_PORT}:8000"
    
  streamlit:
    ports:
      - "${STREAMLIT_PORT}:8501"
    environment:
      - API_URL=http://api:${API_PORT}
```

#### **Configuraci√≥n de Recursos**

Limita recursos para producci√≥n:

```yaml
services:
  api:
    image: TU-USERNAME/house-price-model:latest
    deploy:
      resources:
        limits:
          cpus: '1.0'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
```

---

## üéÆ Gesti√≥n y Operaci√≥n {#gestion}

### **Comandos Esenciales**

#### **Con Script Manager**

```bash
# Iniciar
./docker-manager.sh start

# Ver logs
./docker-manager.sh logs
./docker-manager.sh logs-api
./docker-manager.sh logs-ui

# Estado
./docker-manager.sh status

# Probar
./docker-manager.sh test

# Reiniciar
./docker-manager.sh restart

# Detener
./docker-manager.sh stop

# Limpiar todo
./docker-manager.sh clean

# Rebuild completo
./docker-manager.sh rebuild
```

#### **Comandos Docker Compose Directos**

```bash
# Iniciar
docker-compose up -d

# Logs
docker-compose logs -f [servicio]

# Estado
docker-compose ps

# Reiniciar
docker-compose restart [servicio]

# Detener
docker-compose down

# Rebuild
docker-compose up -d --build [servicio]
```

---

### **Monitoreo de Servicios**

#### **1. Ver Estado en Tiempo Real**

```bash
# Estado de contenedores
watch -n 2 docker-compose ps

# Output:
# NAME              STATUS                   PORTS
# mlops-api         Up 5 minutes (healthy)   0.0.0.0:8000->8000/tcp
# mlops-streamlit   Up 5 minutes (healthy)   0.0.0.0:8501->8501/tcp
```

#### **2. Logs con Filtros**

```bash
# √öltimas 50 l√≠neas
docker-compose logs --tail=50

# Solo errores
docker-compose logs | grep -i error

# Logs de API con timestamp
docker-compose logs -f --timestamps api

# Logs desde hace 10 minutos
docker-compose logs --since 10m
```

#### **3. Inspeccionar Contenedores**

```bash
# Informaci√≥n detallada del contenedor
docker inspect mlops-api

# Ver variables de entorno
docker inspect mlops-api | grep -A 10 Env

# Ver health status
docker inspect mlops-api | grep -A 5 Health
```

#### **4. Recursos y Performance**

```bash
# Uso de CPU/Memoria en tiempo real
docker stats mlops-api mlops-streamlit

# Output:
# CONTAINER       CPU %   MEM USAGE / LIMIT     MEM %
# mlops-api       2.5%    450MiB / 2GiB        22.5%
# mlops-streamlit 1.2%    280MiB / 2GiB        14.0%
```

---

### **Debugging Avanzado**

#### **1. Shell Interactivo**

```bash
# Entrar al contenedor de API
docker-compose exec api bash

# Dentro del contenedor:
ls -la /app/models/trained/
python -c "import joblib; print(joblib.load('/app/models/trained/house_price_model.pkl'))"
curl http://localhost:8000/health
exit
```

#### **2. Verificar Conectividad**

```bash
# Desde streamlit hacia API
docker-compose exec streamlit ping api

# Desde streamlit hacer request a API
docker-compose exec streamlit curl http://api:8000/health
```

#### **3. Inspeccionar Red Docker**

```bash
# Ver red de Docker
docker network ls | grep mlops

# Inspeccionar red
docker network inspect mlops-network

# Ver qu√© contenedores est√°n en la red
docker network inspect mlops-network | grep -A 3 Containers
```

---

## üß™ Testing y Validaci√≥n {#testing}

### **1. Suite de Pruebas Automatizada**

```bash
# Ejecutar todas las pruebas
./test-deployment.sh
```

**Tests incluidos:**
- ‚úÖ Verificaci√≥n de servicios corriendo
- ‚úÖ API health endpoint
- ‚úÖ Predicci√≥n individual
- ‚úÖ Streamlit health
- ‚úÖ Conectividad entre servicios

---

### **2. Test de Carga (Load Testing)**

#### **Con Apache Bench**

```bash
# Instalar ab (si no est√° instalado)
# macOS: brew install httpd
# Ubuntu: sudo apt-get install apache2-utils

# Test con 100 requests, 10 concurrentes
ab -n 100 -c 10 -p test_data.json -T application/json http://localhost:8000/predict
```

#### **Test Data para Load Testing**

Crea `test_data.json`:

```json
{
  "sqft": 2000,
  "bedrooms": 3,
  "bathrooms": 2,
  "location": "Suburb",
  "year_built": 2010,
  "condition": "Good",
  "price_per_sqft": 250
}
```

---

### **3. Ejemplos de API Testing**

```bash
# Ejecutar ejemplos predefinidos
./api-test-examples.sh
```

**Ejemplos incluidos:**
1. Health check
2. Suburban family home
3. Luxury downtown condo
4. Rural property
5. Waterfront estate
6. Small urban apartment

---

### **4. Validaci√≥n de Integraci√≥n UI-API**

#### **Test Manual en UI**

1. Abrir http://localhost:8501
2. Probar diferentes escenarios:
   ```
   Scenario 1: Casa peque√±a urbana
   - sqft: 800
   - bedrooms: 1
   - bathrooms: 1
   - location: Urban
   
   Scenario 2: Casa de lujo
   - sqft: 4000
   - bedrooms: 5
   - bathrooms: 4
   - location: Waterfront
   ```

3. Verificar:
   - Predicci√≥n se muestra correctamente
   - No hay errores de conexi√≥n
   - Confidence interval se calcula
   - Response time es razonable

---

## üö® Troubleshooting {#troubleshooting}

### **Problema 1: Servicios No Inician**

#### **S√≠ntoma:**
```bash
docker-compose ps
# NAME          STATUS
# mlops-api     Exit 1
```

#### **Diagn√≥stico:**

```bash
# Ver logs detallados
docker-compose logs api

# Posibles causas:
# 1. Modelo no encontrado
# 2. Puerto ocupado
# 3. Dependencias faltantes
```

#### **Soluciones:**

**A. Modelo no encontrado:**
```bash
# Verificar que modelos existen
ls -la models/trained/

# Si no existen, entrenar modelo
python src/models/train_model.py --config configs/model_config.yaml

# Reintentar
docker-compose up -d
```

**B. Puerto ocupado:**
```bash
# Identificar proceso usando el puerto
lsof -i :8000

# Matar proceso
kill -9 PID

# O cambiar puerto en docker-compose.yaml
# ports: - "8080:8000"
```

**C. Dependencias faltantes:**
```bash
# Rebuild sin cache
docker-compose build --no-cache api
docker-compose up -d
```

---

### **Problema 2: Streamlit No Conecta con API**

#### **S√≠ntoma:**
En UI aparece: "Error connecting to API"

#### **Diagn√≥stico:**

```bash
# 1. Verificar que API est√° corriendo
curl http://localhost:8000/health

# 2. Verificar logs de Streamlit
docker-compose logs streamlit | grep -i error

# 3. Test de conectividad desde Streamlit
docker-compose exec streamlit curl http://api:8000/health
```

#### **Soluciones:**

**A. API no est√° saludable:**
```bash
# Esperar a que API pase health check
docker-compose logs -f api

# Verificar que aparece:
# ‚úÖ Model loaded: RandomForestRegressor
```

**B. Variable API_URL incorrecta:**
```bash
# Verificar variable de entorno
docker-compose exec streamlit env | grep API_URL

# Debe ser: API_URL=http://api:8000
# No: API_URL=http://localhost:8000
```

**C. Problema de red:**
```bash
# Recrear red
docker-compose down
docker network prune
docker-compose up -d
```

---

### **Problema 3: Imagen de Docker Hub No Descarga**

#### **S√≠ntoma:**
```bash
Error response from daemon: pull access denied for TU-USERNAME/house-price-model
```

#### **Soluciones:**

**A. Login a Docker Hub:**
```bash
# Hacer login
docker login

# Introducir credenciales
Username: TU-USERNAME
Password: [token o password]

# Reintentar
docker-compose pull
docker-compose up -d
```

**B. Verificar que imagen existe:**
```bash
# Verificar en Docker Hub manualmente
open https://hub.docker.com/r/TU-USERNAME/house-price-model

# O con curl
curl -s https://hub.docker.com/v2/repositories/TU-USERNAME/house-price-model/tags
```

**C. Usar imagen alternativa:**
```bash
# Si latest no existe, usar tag espec√≠fico
# Editar docker-compose.yaml:
# image: TU-USERNAME/house-price-model:a1b2c3d
```

---

### **Problema 4: Health Check Falla Constantemente**

#### **S√≠ntoma:**
```bash
docker-compose ps
# mlops-api   Up (unhealthy)
```

#### **Diagn√≥stico:**

```bash
# Ver detalles de health check
docker inspect mlops-api | grep -A 10 Health

# Ver logs de health check failures
docker-compose logs api | grep health
```

#### **Soluciones:**

**A. Aumentar start_period:**
```yaml
# En docker-compose.yaml:
healthcheck:
  start_period: 30s  # Aumentar si modelo es grande
```

**B. Verificar endpoint health:**
```bash
# Test manual
docker-compose exec api curl -f http://localhost:8000/health

# Si falla, verificar c√≥digo de src/api/main.py
```

**C. Deshabilitar temporalmente (solo debug):**
```yaml
# En docker-compose.yaml:
api:
  # healthcheck:  # Comentar para debug
  #   test: [...]
```

---

### **Problema 5: Predicciones Incorrectas**

#### **S√≠ntoma:**
Predicciones no tienen sentido o son muy diferentes a local.

#### **Diagn√≥stico:**

```bash
# 1. Verificar versi√≥n del modelo
docker-compose exec api ls -la /app/models/trained/

# 2. Verificar logs de carga del modelo
docker-compose logs api | grep "Model loaded"

# 3. Comparar modelo local vs contenedor
docker-compose exec api python -c "
import joblib
model = joblib.load('/app/models/trained/house_price_model.pkl')
print(model)
"
```

#### **Soluciones:**

**A. Modelo desactualizado en imagen:**
```bash
# Si usas imagen de Docker Hub, actualizar:
docker pull TU-USERNAME/house-price-model:latest
docker-compose up -d --force-recreate
```

**B. Usar volumen para modelos actualizados:**
```yaml
# En docker-compose.yaml:
api:
  volumes:
    - ./models:/app/models  # Usar modelos locales
```

**C. Re-entrenar y rebuild:**
```bash
# Entrenar nuevo modelo
python src/models/train_model.py --config configs/model_config.yaml

# Rebuild imagen
docker-compose up -d --build api
```

---

### **Problema 6: Logs No Aparecen**

#### **S√≠ntoma:**
`docker-compose logs` no muestra nada o muy poco output.

#### **Soluciones:**

```bash
# A. Verificar que PYTHONUNBUFFERED est√° activado
docker-compose exec api env | grep PYTHONUNBUFFERED

# B. Ver logs con diferentes opciones
docker-compose logs --tail=all api
docker logs mlops-api

# C. Ejecutar con output directo (sin detached)
docker-compose up
```

---

## üìä Comparaci√≥n de M√©todos

| Caracter√≠stica | M√©todo 1: Build Local | M√©todo 2: Docker Hub |
|----------------|----------------------|---------------------|
| **Velocidad inicial** | üêå Lenta (build) | ‚ö° R√°pida (pull) |
| **Espacio en disco** | üíæ Mayor | üíæ Menor |
| **Control de c√≥digo** | ‚úÖ Total | ‚ùå Limitado |
| **Requiere rebuild** | ‚úÖ Frecuente | ‚ùå Raro |
| **Testing CI/CD** | ‚ùå Local only | ‚úÖ Pre-testeado |
| **Conexi√≥n internet** | ‚ùå No requerida | ‚úÖ Requerida (pull) |
| **Ideal para** | Desarrollo activo | Producci√≥n/Deploy |
| **Actualizaci√≥n modelos** | ‚ö° R√°pida (volumen) | üîÑ Requiere rebuild |

---

## üéØ Mejores Pr√°cticas

### **Desarrollo Local**
```bash
# 1. Usar build local con vol√∫menes
# 2. Hot reload para cambios r√°pidos
# 3. Logs en tiempo real
docker-compose up --build
```

### **Staging/Testing**
```bash
# 1. Usar imagen de Docker Hub (latest)
# 2. Variables de entorno espec√≠ficas
# 3. Health checks habilitados
docker-compose -f docker-compose.staging.yaml up -d
```

### **Producci√≥n**
```bash
# 1. Usar imagen con tag espec√≠fico (no latest)
# 2. L√≠mites de recursos configurados
# 3. Logging a sistema externo
# 4. Monitoreo continuo
docker-compose -f docker-compose.prod.yaml up -d
```

---

## üìö Recursos Adicionales

### **Archivos de Referencia**

- `docker-compose.yaml` - Configuraci√≥n de servicios
- `docker-manager.sh` - Script helper para gesti√≥n
- `test-deployment.sh` - Suite de pruebas
- `api-test-examples.sh` - Ejemplos de uso de API
- `QUICKSTART.md` - Inicio r√°pido
- `DOCKER_SETUP.md` - Documentaci√≥n detallada

### **Documentaci√≥n Relacionada**

- [4. mlops-model-dockerization.md](4.%20mlops-model-dockerization.md) - Dockerizaci√≥n del modelo
- [5. mlops-workflow-model-publish.md](5.%20mlops-workflow-model-publish.md) - CI/CD y publicaci√≥n

### **Links Externos**

- [Docker Compose Documentation](https://docs.docker.com/compose/)
- [FastAPI Deployment](https://fastapi.tiangolo.com/deployment/docker/)
- [Streamlit Docker](https://docs.streamlit.io/knowledge-base/tutorials/deploy/docker)

---

## ‚úÖ Checklist Final

### **Antes de Deploy**
- [ ] Modelos entrenados en `models/trained/`
- [ ] Dockerfiles configurados
- [ ] docker-compose.yaml creado
- [ ] Variables de entorno configuradas (si aplica)
- [ ] Health checks implementados en API

### **Post-Deploy**
- [ ] Servicios corriendo: `docker-compose ps`
- [ ] Health checks pasan: `curl http://localhost:8000/health`
- [ ] Predicciones funcionan: `curl -X POST http://localhost:8000/predict`
- [ ] Streamlit accesible: http://localhost:8501
- [ ] Logs sin errores: `docker-compose logs`
- [ ] Tests pasan: `./test-deployment.sh`

### **Producci√≥n**
- [ ] Imagen testeada en CI/CD
- [ ] Tag espec√≠fico (no latest)
- [ ] Recursos limitados
- [ ] Monitoreo configurado
- [ ] Backup strategy definida
- [ ] Rollback plan preparado

---

## üéì Pr√≥ximos Pasos

Una vez que tu stack est√© funcionando con Docker Compose:

1. **CI/CD**: Automatizar deployment con GitHub Actions
2. **Kubernetes**: Migrar a K8s para escalabilidad
3. **Monitoring**: Implementar Prometheus + Grafana
4. **Logging**: Centralizar logs con ELK stack
5. **Security**: Implementar secrets management
6. **Scaling**: Auto-scaling basado en load

---

## üõ†Ô∏è Scripts Helper Avanzados {#scripts-helper}

### **Resumen de Archivos Creados**

Durante esta gu√≠a, hemos creado los siguientes archivos helper:

```
mlops-lab/
‚îú‚îÄ‚îÄ üìÑ docker-compose.yaml           ‚Üê Orquestaci√≥n de servicios
‚îú‚îÄ‚îÄ üìÑ Dockerfile                    ‚Üê Imagen de FastAPI (existente)
‚îú‚îÄ‚îÄ üìÑ .dockerignore                 ‚Üê Optimizaci√≥n de build
‚îú‚îÄ‚îÄ üìÑ .env.example                  ‚Üê Template de variables de entorno
‚îú‚îÄ‚îÄ üöÄ docker-manager.sh             ‚Üê Script helper (ejecutable)
‚îú‚îÄ‚îÄ üß™ test-deployment.sh            ‚Üê Suite de pruebas (ejecutable)
‚îú‚îÄ‚îÄ üß™ api-test-examples.sh          ‚Üê Ejemplos de API (ejecutable)
‚îú‚îÄ‚îÄ üìñ QUICKSTART.md                 ‚Üê Gu√≠a de inicio r√°pido
‚îî‚îÄ‚îÄ üìÅ streamlit_app/
    ‚îî‚îÄ‚îÄ üìÑ Dockerfile                ‚Üê Imagen de Streamlit (existente)
```

---

### **Uso de Scripts Helper**

#### **1. docker-manager.sh - Gestor Principal**

Script todo-en-uno para gesti√≥n de Docker Compose:

```bash
# Ver todas las opciones disponibles
./docker-manager.sh help

# Comandos m√°s usados:
./docker-manager.sh start       # Iniciar todo
./docker-manager.sh stop        # Detener todo
./docker-manager.sh logs        # Ver logs
./docker-manager.sh status      # Ver estado
./docker-manager.sh test        # Probar API
./docker-manager.sh rebuild     # Reconstruir todo
./docker-manager.sh clean       # Limpiar todo

# Comandos avanzados:
./docker-manager.sh shell-api   # Shell en contenedor API
./docker-manager.sh shell-ui    # Shell en contenedor Streamlit
./docker-manager.sh logs-api    # Solo logs de API
./docker-manager.sh logs-ui     # Solo logs de Streamlit
```

**Caracter√≠sticas:**
- ‚úÖ Output colorizado para mejor legibilidad
- ‚úÖ Validaci√≥n de estado antes de ejecutar comandos
- ‚úÖ Mensajes de ayuda contextuales
- ‚úÖ Manejo de errores robusto
- ‚úÖ URLs de acceso mostradas autom√°ticamente

---

#### **2. test-deployment.sh - Suite de Pruebas**

Script de validaci√≥n completa del deployment:

```bash
# Ejecutar todas las pruebas
./test-deployment.sh
```

**Tests incluidos:**
1. ‚úÖ Verificaci√≥n de servicios corriendo
2. ‚úÖ API health endpoint
3. ‚úÖ API documentation endpoint
4. ‚úÖ Predicci√≥n individual
5. ‚úÖ Streamlit health check
6. ‚úÖ Conectividad de red entre servicios

**Output esperado:**
```
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  MLOps Lab - Quick Test Suite            ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

üìä Checking if services are running...
‚úÖ Services are running

üè• Testing API health endpoint...
‚úÖ API health check passed

üîÆ Testing prediction endpoint...
‚úÖ Prediction endpoint working
   Predicted Price: $525,000.00

üé® Testing Streamlit frontend...
‚úÖ Streamlit is accessible

üåê Testing network connectivity...
‚úÖ Streamlit can reach API backend

‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë  ‚úÖ All Tests Passed Successfully!       ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
```

---

#### **3. api-test-examples.sh - Ejemplos de Uso**

Script con ejemplos predefinidos de uso de la API:

```bash
# Ejecutar todos los ejemplos
./api-test-examples.sh
```

**Ejemplos incluidos:**
1. Health check b√°sico
2. Suburban family home (casa suburbana t√≠pica)
3. Luxury downtown condo (departamento de lujo)
4. Rural property (propiedad rural)
5. Waterfront estate (casa frente al mar)
6. Small urban apartment (apartamento urbano peque√±o)

**Uso:**
- Ver sintaxis de requests
- Validar formato de respuestas
- Probar diferentes escenarios
- Debugging de API

---

### **Workflow Recomendado**

#### **Desarrollo Diario**

```bash
# 1. Iniciar servicios por la ma√±ana
./docker-manager.sh start

# 2. Verificar que todo funciona
./test-deployment.sh

# 3. Ver logs mientras trabajas
./docker-manager.sh logs-api    # En una terminal
./docker-manager.sh logs-ui     # En otra terminal

# 4. Despu√©s de cambios en c√≥digo
docker-compose up -d --build api

# 5. Al final del d√≠a
./docker-manager.sh stop
```

#### **Testing y Validaci√≥n**

```bash
# 1. Test r√°pido de salud
curl http://localhost:8000/health

# 2. Suite completa de pruebas
./test-deployment.sh

# 3. Probar diferentes escenarios
./api-test-examples.sh

# 4. Test manual en UI
open http://localhost:8501
```

#### **Debugging y Troubleshooting**

```bash
# 1. Ver logs recientes
./docker-manager.sh logs --tail=100

# 2. Verificar estado de contenedores
./docker-manager.sh status

# 3. Entrar al contenedor para debug
./docker-manager.sh shell-api

# Dentro del contenedor:
ls -la /app/models/trained/
python -c "import joblib; print(joblib.load('/app/models/trained/house_price_model.pkl'))"
curl http://localhost:8000/health
exit

# 4. Si hay problemas, rebuild desde cero
./docker-manager.sh rebuild
```

---

### **Integraci√≥n con CI/CD**

Los scripts tambi√©n se pueden usar en pipelines de CI/CD:

```yaml
# Ejemplo en GitHub Actions
- name: Start Services
  run: ./docker-manager.sh start

- name: Run Tests
  run: ./test-deployment.sh

- name: API Examples
  run: ./api-test-examples.sh

- name: Cleanup
  run: ./docker-manager.sh clean
```

---

### **Personalizaci√≥n de Scripts**

Puedes modificar los scripts seg√∫n tus necesidades:

#### **A√±adir nuevos comandos a docker-manager.sh**

```bash
# A√±adir funci√≥n personalizada
my_custom_function() {
    echo -e "${YELLOW}üîß Running custom task...${NC}"
    # Tu c√≥digo aqu√≠
}

# A√±adir al case statement
case "${1:-help}" in
    # ... comandos existentes ...
    custom)
        my_custom_function
        ;;
esac
```

#### **A√±adir nuevas pruebas a test-deployment.sh**

```bash
# Test personalizado
echo -e "${YELLOW}üß™ Testing custom endpoint...${NC}"
if curl -s -f http://localhost:8000/my-endpoint > /dev/null; then
    echo -e "${GREEN}‚úÖ Custom endpoint working${NC}"
else
    echo -e "${RED}‚ùå Custom endpoint failed${NC}"
    exit 1
fi
```

---

### **Tips y Mejores Pr√°cticas**

1. **Usa docker-manager.sh para operaciones comunes**
   - M√°s r√°pido que escribir comandos docker-compose completos
   - Output m√°s claro y legible
   - Menos propenso a errores

2. **Ejecuta test-deployment.sh despu√©s de cambios**
   - Antes de commits importantes
   - Despu√©s de actualizar modelos
   - Antes de despliegues a producci√≥n

3. **Usa api-test-examples.sh para aprender**
   - Ver sintaxis correcta de requests
   - Entender estructura de respuestas
   - Validar comportamiento esperado

4. **Mant√©n los scripts actualizados**
   - A√±ade tests para nuevos endpoints
   - Actualiza ejemplos con nuevos features
   - Documenta cambios importantes

5. **Comparte scripts con el equipo**
   - Asegura consistencia en workflows
   - Facilita onboarding de nuevos miembros
   - Reduce tiempo de configuraci√≥n

---

## üìä Resumen Final

### **¬øQu√© Hemos Logrado?**

‚úÖ **Orquestaci√≥n Completa**
- 2 servicios (API + UI) funcionando coordinadamente
- Red privada para comunicaci√≥n segura
- Health checks autom√°ticos
- Auto-restart en caso de fallos

‚úÖ **Scripts Helper Potentes**
- `docker-manager.sh` - Gesti√≥n simplificada
- `test-deployment.sh` - Validaci√≥n automatizada
- `api-test-examples.sh` - Ejemplos de uso

‚úÖ **Documentaci√≥n Completa**
- Gu√≠a paso a paso
- Troubleshooting detallado
- Quick start para inicio r√°pido
- Comparaci√≥n de m√©todos (local vs Docker Hub)

‚úÖ **Preparado para Producci√≥n**
- Variables de entorno configurables
- L√≠mites de recursos
- Vol√∫menes para persistencia
- Logging estructurado

---

### **Comando √önico para Empezar**

```bash
# Todo en 3 comandos:
chmod +x *.sh
./docker-manager.sh start
./test-deployment.sh
```

**¬°Y est√°s listo! üéâ**

Accede a:
- üé® **UI**: http://localhost:8501
- ‚ö° **API**: http://localhost:8000
- üìö **Docs**: http://localhost:8000/docs

---

**üèÜ ¬°Felicidades! Ahora tienes tu stack MLOps completo funcionando con Docker Compose. Tu aplicaci√≥n est√° lista para desarrollo, testing y producci√≥n.**
